@{
    ViewData["Title"] = "Inteligencia Artificial";
}

<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="site.css">
    <title>Oráculo</title>

    

    <script>
        function Send() {

            var selLang = "pt-BR"

            var sQuestion = txtMsg.value;
            if (sQuestion == "") {
                alert("Me pergunte alguma coisa!");
                txtMsg.focus();
                return;
            }

            var oHttp = new XMLHttpRequest();
            oHttp.open("POST", "https://api.openai.com/v1/completions");
            oHttp.setRequestHeader("Accept", "application/json");
            oHttp.setRequestHeader("Content-Type", "application/json");
            oHttp.setRequestHeader("Authorization", "Bearer " + "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")

            oHttp.onreadystatechange = function () {
                if (oHttp.readyState === 4) {
                    //console.log(oHttp.status);
                    var oJson = {}
                    if (txtOutput.value != "") txtOutput.value += "\n";

                    try {
                        oJson = JSON.parse(oHttp.responseText);
                    } catch (ex) {
                        txtOutput.value += "Erro: " + ex.message
                    }

                    if (oJson.error && oJson.error.message) {
                        txtOutput.value += "Erro: " + oJson.error.message;
                    } else if (oJson.choices && oJson.choices[0].text) {
                        var s = oJson.choices[0].text;

                        if (selLang.value != "en-US") {
                            var a = s.split("?\n");
                            if (a.length == 2) {
                                s = a[1];
                            }
                        }

                        if (s == "") s = "Sem resposta";
                        txtOutput.value += "Oráculo: " + s;
                        TextToSpeech(s);
                    }
                }
            };

            var sModel = "text-davinci-003";
            var iMaxTokens = 2048;
            var sUserId = "1";
            var dTemperature = 0.7;

            var data = {
                model: sModel,
                prompt: sQuestion,
                max_tokens: iMaxTokens,
                user: sUserId,
                temperature: dTemperature,
                frequency_penalty: 0.0, //Number between -2.0 and 2.0
                //Positive values decrease the model's likelihood
                //to repeat the same line verbatim.
                presence_penalty: 0.0,  //Number between -2.0 and 2.0.
                //Positive values increase the model's likelihood
                //to talk about new topics.
                stop: ["#", ";"]        //Up to 4 sequences where the API will stop
                //generating further tokens. The returned text
                //will not contain the stop sequence.
            }

            oHttp.send(JSON.stringify(data));

            if (txtOutput.value != "") txtOutput.value += "\n";
            txtMsg.value = "";
        }
    </script>


    <script>
           const textarea = document.getElementById('textarea');

        textarea.addEventListener('input', function ()
        {
            // Define a altura mínima do textarea para evitar que ele fique muito pequeno
            this.style.height = 'auto';
            // Define a altura do textarea com base no conteúdo
            this.style.height = (this.scrollHeight) + 'px';
        });


    </script>


</head>
<body>
    <div class="container">
    <div class="coluna">
        <div class="cartao">
            <img src="/images/oraculo.png" />
        </div>
    </div>

    <div id="idContainer">
        <textarea id="txtMsg" rows="5" wrap="soft" style="width: 98%; margin-left: 3px" placeholder="Me pergunte qualquer coisa!"></textarea>

        <button class="btnVoz" id="startButton">Iniciar Reconhecimento de Voz</button>
        <button class="btnVoz" id="stopButton">Parar Reconhecimento de Voz</button><br /><br />

        <button class="btnSend" type="button" onclick="Send()" id="btnSend">Enviar</button>    
        <button class="btnSend" type="button" id="limparButton">Recomeçar</button> <br />

        <style>
            .btnSend{
                background-color: #2980b9;
                color: black;
                border: none;
                padding: 10px 20px;
                border-radius: 10px;
                cursor: pointer;
                outline: black;
            }

            .btnVoz {
                border: none;
                padding: 10px 20px;
                border-radius: 10px;
                cursor: pointer;
                outline: black;
            }
        </style>
        <script>
            document.getElementById('limparButton').addEventListener('click', function ()
            {
                var textareas = document.querySelectorAll('textarea');
                for (var i = 0; i < textareas.length; i++)
                {
                    textareas[i].value = ''; // Limpar o conteúdo da textarea
                }
            });
        </script>
        Resposta:
        <textarea id="txtOutput" rows="5" wrap="soft" style="width: 98%; margin-left: 3px; margin-top: 5px" placeholder=""></textarea>
        
        <script>
            function updateOutput(content) {
                const txtOutput = document.getElementById("txtOutput");
                otxtOutput.innerHTML = content;
        </script>


        <div id="idText"></div>
    </div>
    <br />
    <br />



    <script src="~/js/ReconhecimentoVoz_Oraculo.js"> </script>
</body>
</html>