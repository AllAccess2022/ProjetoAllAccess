@{
    ViewData["Title"] = "Inteligencia Artificial";
}

<!DOCTYPE html>
<html>
<head>
    <title>Chat GPT</title>
    <script>
        function Send() {

            var selLang = "pt-BR"

            var sQuestion = txtMsg.value;
            if (sQuestion == "") {
                alert("Digite sua pergunta!");
                txtMsg.focus();
                return;
            }

            var oHttp = new XMLHttpRequest();
            oHttp.open("POST", "https://api.openai.com/v1/completions");
            oHttp.setRequestHeader("Accept", "application/json");
            oHttp.setRequestHeader("Content-Type", "application/json");
            oHttp.setRequestHeader("Authorization", "Bearer " + "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")

            oHttp.onreadystatechange = function () {
                if (oHttp.readyState === 4) {
                    //console.log(oHttp.status);
                    var oJson = {}
                    if (txtOutput.value != "") txtOutput.value += "\n";

                    try {
                        oJson = JSON.parse(oHttp.responseText);
                    } catch (ex) {
                        txtOutput.value += "Erro: " + ex.message
                    }

                    if (oJson.error && oJson.error.message) {
                        txtOutput.value += "Erro: " + oJson.error.message;
                    } else if (oJson.choices && oJson.choices[0].text) {
                        var s = oJson.choices[0].text;

                        if (selLang.value != "en-US") {
                            var a = s.split("?\n");
                            if (a.length == 2) {
                                s = a[1];
                            }
                        }

                        if (s == "") s = "Sem resposta";
                        txtOutput.value += "Gui BOT: " + s;
                        TextToSpeech(s);
                    }
                }
            };

            var sModel = "text-davinci-003";
            var iMaxTokens = 2048;
            var sUserId = "1";
            var dTemperature = 0.7;

            var data = {
                model: sModel,
                prompt: sQuestion,
                max_tokens: iMaxTokens,
                user: sUserId,
                temperature: dTemperature,
                frequency_penalty: 0.0, //Number between -2.0 and 2.0
                //Positive values decrease the model's likelihood
                //to repeat the same line verbatim.
                presence_penalty: 0.0,  //Number between -2.0 and 2.0.
                //Positive values increase the model's likelihood
                //to talk about new topics.
                stop: ["#", ";"]        //Up to 4 sequences where the API will stop
                //generating further tokens. The returned text
                //will not contain the stop sequence.
            }

            oHttp.send(JSON.stringify(data));

            if (txtOutput.value != "") txtOutput.value += "\n";
            txtOutput.value += "Você: " + sQuestion;
            txtMsg.value = "";
        }
    </script>
    <link rel="stylesheet" type="text/css" href="chat.css">
</head>
<body>
    <style>
        textarea{
            resize: none;
        }
        #txtOutput{
            overflow: auto;
            pointer-events: none;
        }

        #idContainer{
            align-self: center;
            resize: none;
            overflow: auto;
            border-radius: 15px 50px 30px;
            background: lightblue;
            border: 2px solid darkblue;
            padding: 20px;
            justify-content: center;
            height: 100%;
            width: 50%;
        }
        #btnSend{
            background: rgba(0, 105, 255, .2);
            
            border-bottom-left-radius: 7px;
            border-bottom-right-radius: 7px;
            border-top-left-radius: 7px;
            border-top-right-radius: 7px;
        }
    </style>
    <center>
    <div id="idContainer">
        <textarea id="txtMsg" rows="5" wrap="soft" style="width: 98%; margin-left: 3px" placeholder="Digite aqui!"></textarea>

        <div>
            <button type="button" onclick="Send()" id="btnSend">Enviar</button>
        </div>

        <textarea id="txtOutput" rows="5" wrap="soft" style="width: 98%; margin-left: 3px; margin-top: 5px" placeholder="Saída"></textarea>
        
        <script>
            function updateOutput(content) {
                const txtOutput = document.getElementById("txtOutput");
                otxtOutput.innerHTML = content;
        </script>

        <div id="idText"></div>
    </div>
    </center>

</body>
</html>